import{p as B,aq as D,ar as j,n as O,U as Q,r as c,Q as T,Y as V,a as U,_ as d,a5 as f,a4 as n,a9 as I,a6 as m,as as x,$ as z,a2 as v,H as g,at as K,a1 as i,a0 as h,au as $,av as b,aw as M,ax as J,ao as H,a3 as Y}from"./index.47a28144.js";import{C as G,a as W,b as X,c as Z}from"./index.6c2dd6cd.js";import{u as ee,a as te}from"./use-quasar.3a6fa932.js";import"./axios.66614422.js";function C(t){if(t===!1)return 0;if(t===!0||t===void 0)return 1;const o=parseInt(t,10);return isNaN(o)?0:o}var k=B({name:"close-popup",beforeMount(t,{value:o}){const s={depth:C(o),handler(l){s.depth!==0&&setTimeout(()=>{const p=D(t);p!==void 0&&j(p,l,s.depth)})},handlerKey(l){O(l,13)===!0&&s.handler(l)}};t.__qclosepopup=s,t.addEventListener("click",s.handler),t.addEventListener("keyup",s.handlerKey)},updated(t,{value:o,oldValue:s}){o!==s&&(t.__qclosepopup.depth=C(o))},beforeUnmount(t){const o=t.__qclosepopup;t.removeEventListener("click",o.handler),t.removeEventListener("keyup",o.handlerKey),delete t.__qclosepopup}});const ae={class:"row text-uppercase text-grey-8 justify-center items-center content-center q-pa-xs text-center",style:{"font-family":"'Bebas Neue'"}},oe={class:"q-pt-none"},se={key:0,class:"col-12 text-center q-pt-none"},re=["src"],ne={key:1,class:"col-12 text-center q-pt-none"},le=["src"],ie={class:"row justify-center q-pt-lg"},ce={class:"col text-center"},ue={key:0},de={key:1,class:"q-py-sm"},pe=n("span",null,"\xBFEst\xE1 seguro de usar esta foto para sus registros de asistencia?",-1),fe=n("div",null,[n("span",null,[n("strong",null,"Nota: "),Y(" Una vez que haya registrado la foto, no podr\xE1 realizar modificaciones. Por favor, aseg\xFArese de que la imagen muestre su rostro de manera clara y centrada.")])],-1),ge=Q({__name:"RegistroFacialPage",setup(t){const o=c(),s=c(),l=c(0),p=c(""),q=ee(),u=c(!1),_=c(!1),N=c(!1),E="/opt/control-asistencia/control_asistencia_api/src/public/fotos",F="https://apromedfarmaloja-cloud.com:8000/static",{get:R,post:y}=te(),P=async()=>{try{const a=await G.getPhoto({quality:90,allowEditing:!1,resultType:W.Uri,source:X.Camera,direction:Z.Front,width:1024,height:768});if(a.webPath){o.value=a.webPath;const e=await fetch(a.webPath);if(e.ok){const r=await e.blob();s.value=new File([r],"foto.jpg")}}}catch(a){console.error("[ERROR AL TOMAR LA SELFIE] :",a)}},S=async a=>{try{const e=new FormData;return e.append("file",a),(await y("/subir_foto",{},e)).objetos}catch(e){console.error("[ERROR AL SUBIR LA FOTO]:",e)}},L=async a=>{if(a){const e=await S(a),r=await y("/registrar_foto",{},JSON.parse(JSON.stringify({filepath:e,usuario:l.value})));r.error==="N"&&w(l.value),q.notify({color:r.error==="N"?"green-4":"red-5",textColor:"white",icon:r.error==="N"?"cloud_done":"warning",message:r.mensaje}),_.value=!1}},w=async a=>{const e=await R("/obtener_foto",{usuario:a});e.error==="N"&&(p.value=e.objetos[0].path,u.value=!0)};T(()=>{const a=V.getItem("session");l.value=(a==null?void 0:a.codigo)||0,w(l.value)});const A=U(()=>u.value?"La foto ya se encuentra registrada":"Registro Facial");return(a,e)=>(d(),f(H,null,[n("h4",ae,[n("div",oe,I(A.value),1)]),o.value&&!u.value?(d(),f("div",se,[n("img",{src:o.value,alt:"Foto tomada",style:{width:"340px"}},null,8,re)])):m("",!0),u.value?(d(),f("div",ne,[n("img",{src:p.value.replace(x(E),x(F)),alt:"Foto tomada",style:{width:"340px"}},null,8,le)])):m("",!0),n("div",ie,[n("div",ce,[o.value?(d(),f("div",ue,[u.value?m("",!0):(d(),z(v,{key:0,"no-caps":"",color:"primary",rounded:"",icon:"upload",label:"Registrar selfie",size:"lg",onClick:e[0]||(e[0]=r=>_.value=!0)}))])):m("",!0),u.value?m("",!0):(d(),f("div",de,[g(i(v,{"no-caps":"",color:"primary",rounded:"",icon:"camera_alt",label:"Tomar selfie",size:"lg",onClick:P},null,512),[[K,!N.value]])]))])]),n("div",null,[i(J,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=r=>_.value=r),persistent:""},{default:h(()=>[i($,null,{default:h(()=>[i(b,{class:"row items-center"},{default:h(()=>[pe]),_:1}),i(b,{class:"row items-center"},{default:h(()=>[fe]),_:1}),i(M,{align:"right"},{default:h(()=>[g(i(v,{flat:"",label:"Cancelar",color:"red"},null,512),[[k]]),g(i(v,{flat:"",label:"Registrar selfie",color:"primary",onClick:e[1]||(e[1]=r=>L(s.value))},null,512),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64))}});export{ge as default};
