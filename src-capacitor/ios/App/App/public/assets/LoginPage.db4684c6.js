import{aD as T,aE as j,h as n,c as A,aF as B,aG as q,U as D,V as F,X as L,r as s,Q as O,Y as J,w as z,_ as K,$ as Y,a0 as u,a1 as o,au as U,av as G,aH as h,aw as H,a2 as E,ax as X,a4 as i,aI as W,a7 as Z,a8 as ee,aJ as y}from"./index.47a28144.js";import{Q as ae}from"./QPage.1664443c.js";import{u as te,a as oe}from"./use-quasar.3a6fa932.js";import"./axios.66614422.js";function re(){return{mostrarMensaje:(r,l)=>T.create({title:r,message:l,html:!0}),mostrarConfirmacion:(r,l)=>{r.trim().length!==0&&j.create({message:r,color:"grey-8",multiLine:!0,position:l===void 0?"center":l,icon:"info",html:!0,actions:[{label:"Cerrar",color:"white",handler:()=>{}}]})},mostrarError:(r,l)=>{r.trim().length!==0&&j.create({message:r,color:"red-4",textColor:"white",multiLine:!0,position:l===void 0?"center":l,icon:"error",html:!0,actions:[{label:"Cerrar",color:"white",handler:()=>{}}]})}}}const se=[n("g",{transform:"translate(20 50)"},[n("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.6"},[n("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),n("g",{transform:"translate(50 50)"},[n("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.8"},[n("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),n("g",{transform:"translate(80 50)"},[n("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.9"},[n("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var le=A({name:"QSpinnerFacebook",props:B,setup(b){const{cSize:c,classes:m}=q(b);return()=>n("svg",{class:m.value,width:c.value,height:c.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},se)}});const ne=i("div",{class:"row bg-blue-8 justify-center q-pa-xs"},[i("span",{class:"text-h6 text-center text-white",style:{"font-family":"'Bebas Neue'"}},"Cambiar clave de acceso")],-1),ie=i("div",{class:"row bg-blue-8 justify-center q-pa-xs"},[i("span",{class:"text-h6 text-center text-white",style:{"font-family":"'Bebas Neue'"}},"CONTROL DE ASISTENCIA APP V0.1")],-1),ue={class:"row"},ce={class:"column col-xs-12 q-pa-sm"},de={class:"column col-xs-12 q-pa-sm"},me={class:"row"},pe={class:"column col-xs-12 q-pa-sm"},ye=D({__name:"LoginPage",setup(b){const c=te(),m=F(),r=L(),l=s(r.url),{get:w,put:M}=oe(),{mostrarMensaje:x}=re(),C=s(!1),v=s(""),p=s(""),d=s(""),g=s(""),f=s(!0),P=s(l.value.slice(l.value.indexOf("#")+1)),$=[e=>!!e||"El RUC es obligatorio",e=>/^\d{13}$/.test(e)||"El RUC debe contener 13 d\xEDgitos"],S=s(""),I=[e=>!!e||"El correo electr\xF3nico es obligatorio",e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Formato de correo electr\xF3nico inv\xE1lido"],V=s(0),k=s("");O(()=>{const e=J.getItem("session");d.value=(e==null?void 0:e.login)||"",k.value=(e==null?void 0:e.usuario)||"",V.value=(e==null?void 0:e.codigo)||0,S.value=(e==null?void 0:e.token)||"",e&&(r.iniciarSesion(S.value,V.value,k.value,d.value),m.push(P.value))});const Q=async()=>{if(d.value.trim().length===0){x("Error","Es necesario ingresar su nombre de usuario para continuar");return}if(g.value.trim().length===0){x("Error","Es obligatorio ingresar su clave de acceso");return}y.show({spinner:le,message:"Verificando acceso..."});const e=await w("/validar_usuario",{id:d.value,clave:g.value,sys:0});if(e.error==="S"){c.notify({color:"red-5",textColor:"white",icon:"warning",message:e.mensaje}),y.hide();return}let a,t;if(e.error==="N"){a=e.objetos[0];const _=await w("/obtener_empleado_app",{id:a.codigo});if(_.error==="S"){c.notify({color:"red-5",textColor:"white",icon:"warning",message:_.mensaje}),y.hide();return}t=_.objetos[0]}if(r.actualizarDatos(a.usu_nomape,t.codigo,a.usu_login),y.hide(),e.error==="S"){x("Error",e.mensaje);return}r.iniciarSesion(e.token,t.codigo,a.usu_nomape,a.usu_login),m.push("/")};async function N(){try{const e=await w("/obtener_usuario",{id:p.value});v.value=e.objetos}catch(e){console.error("Error fetching email:",e)}}z(p,N);const R=async()=>{try{const e=await M("/resetear_clave_acceso",{},JSON.parse(JSON.stringify({email:v.value,ruc:p.value})));console.log(e)}catch(e){console.error("Error sending email:",e)}};return(e,a)=>(K(),Y(ae,{class:"flex flex-center bg-image"},{default:u(()=>[o(X,{modelValue:C.value,"onUpdate:modelValue":a[4]||(a[4]=t=>C.value=t),persistent:""},{default:u(()=>[o(U,null,{default:u(()=>[ne,o(G,null,{default:u(()=>[o(h,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=t=>p.value=t),debounce:"750",label:"RUC | CI | Pasaporte",dense:"",rules:$,onInput:N},null,8,["modelValue"]),o(h,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=t=>v.value=t),debounce:"750",label:"Email",dense:"",rules:I},null,8,["modelValue"])]),_:1}),o(H,{align:"right"},{default:u(()=>[o(E,{color:"primary",label:"Enviar",onClick:a[2]||(a[2]=t=>R())}),o(E,{flat:"",label:"Cerrar",onClick:a[3]||(a[3]=t=>C.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(U,{class:"shadow-8 bg-white",style:{width:"300px",height:"260px"}},{default:u(()=>[ie,i("div",ue,[i("div",ce,[o(h,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=t=>d.value=t),type:"text",label:"Usuario",dense:""},null,8,["modelValue"])]),i("div",de,[o(h,{modelValue:g.value,"onUpdate:modelValue":a[7]||(a[7]=t=>g.value=t),dense:"",type:f.value?"password":"text",label:"Clave de acceso",onKeyup:a[8]||(a[8]=W(t=>Q(),["enter"]))},{append:u(()=>[o(Z,{name:f.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:a[6]||(a[6]=t=>f.value=!f.value)},null,8,["name"])]),_:1},8,["modelValue","type"])])]),o(ee,{dark:""}),i("div",me,[i("div",pe,[o(E,{class:"full-width text-white",style:{height:"40px"},color:"primary",label:"Ingresar",onClick:a[9]||(a[9]=t=>Q())})])])]),_:1})]),_:1}))}});export{ye as default};
